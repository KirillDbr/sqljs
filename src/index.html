<!DOCTYPE html>
<html>
	<head>
		<meta charset='utf-8'>
	
		<link rel='stylesheet' href='./lib/css/qunit-1.14.0.css'>
	
		<script src='./lib/jquery-1.11.0.min.js'></script>
		<script src='./lib/peg-0.8.0.js'></script>
		
		<script src='./lib/qunit-1.14.0.js'></script>
		
		<script id='sql_grammar' type='text/plain'>
			start 
				= sql_create_database

			sql_create_table
				= 'CREATE'i npc+ 'TABLE'i npc* '(' npc* ')' 
				{  
					var table = new (function(){
						var self = this;
						self.title = function(){ return "I'm table" };
					})();
					return "Hello";
				} 

			sql_create_database
				=  'CREATE'i npc+ 'DATABASE'i npc+ name:database_name
				{  
					var database = new Database({name: name});
					SQL.databases[name] = database;
					return null;
				} 

			npc
				= [ \t\r\n]

			name 
				= str:[A-Za-z0-9_]+ { return str.join(''); }

			database_name = name
		</script>
		
		<script>
			var parser = (function(){
				var sqlGrammar = $('#sql_grammar').text();
				var parser = PEG.buildParser(sqlGrammar, {
					cache:		false	// make parser faster for dev purposes
					,optimize:	'speed'
				});
				return parser;
			})();
		</script>
		
		<script>
			function Database(args){
				var self = this;
				self.name = args.name;
			};
		</script>
		
		<script>
			var SQL = new (function(){
				var self = this;
				
				self.databases = {};
				
				self.processSqlStmt = function( sqlstmt ) {
					return parser.parse(sqlstmt);
				};
								
				// making SQL callable
				var f = function( sqlstmt ) { return self.processSqlStmt( sqlstmt ); };	
				for(var prop in self){ if(self.hasOwnProperty(prop)) { f[prop] = self[prop]; } }
				return f;
			});
		</script>
		
		<script>
			test( 'Database manilupation test', function(){
				SQL( 'CREATE DATABASE TESTDB' );
				ok( SQL.databases['TESTDB'] != null, 'Passed!' );
			});
		</script>
		
		<script>
			$(document).ready(function( ) {
				//var result = parser.parse('CREATE TABLE ( )');
				
			});
		</script>
	</head>
	<body>
		<div id="qunit"></div>
		<div id="qunit-fixture"></div>
	</body>
</html>